# CDN 优化说明

## 🎯 问题
原来使用的 jsDelivr CDN 在某些网络环境下无法访问，导致：
- `ERR_CONNECTION_TIMED_OUT` 错误
- `echarts is not defined` 错误
- 页面无法正常显示图表

## ✅ 解决方案

### 多 CDN 自动切换机制

现在页面会自动尝试多个 CDN 源，按以下顺序：

1. **字节跳动 CDN** (bytecdntp.com)
   - 国内访问速度快
   - 稳定性高

2. **七牛云 CDN** (staticfile.org)
   - 国内知名 CDN 服务商
   - 支持 HTTPS
   - 资源丰富

3. **又拍云 CDN** (unpkg.com)
   - 国际化 CDN
   - 自动同步 npm 包

4. **Cloudflare CDN** (cdnjs.cloudflare.com)
   - 全球 CDN 网络
   - 高可用性

5. **jsDelivr CDN** (cdn.jsdelivr.net)
   - 备用方案
   - 全球分布

### 工作原理

```javascript
1. 页面加载时，尝试从第一个 CDN 加载 ECharts
2. 如果 10 秒内未加载成功，自动切换到下一个 CDN
3. 依次尝试所有 CDN，直到成功
4. 如果所有 CDN 都失败，显示友好的错误提示
```

### 加载超时设置

- 单个 CDN 超时时间：10 秒
- 总等待时间：最多 30 秒
- 自动重试：是

## 🔍 如何查看使用的 CDN

打开浏览器控制台（F12），查看日志：

```
尝试加载 字节跳动 CDN (1/5)
✓ ECharts 加载成功 (字节跳动 CDN)
✓ 词云插件加载成功 (字节跳动 CDN)
✓ 使用 字节跳动 CDN 加载成功
```

## 🐛 如果仍然无法加载

### Safari 浏览器

Safari 的"防止跨站跟踪"功能可能会阻止 CDN 资源：

1. 打开 Safari 设置
2. 点击"隐私"
3. 取消勾选"防止跨站跟踪"
4. 刷新页面

### Chrome/Edge 浏览器

1. 检查是否安装了广告拦截插件
2. 尝试在隐私模式下打开
3. 检查网络连接

### 企业网络

如果在公司网络环境：
1. 可能需要配置代理
2. 联系 IT 部门检查防火墙设置
3. 某些 CDN 可能被公司网络屏蔽

## 📊 CDN 性能对比

| CDN 名称 | 国内速度 | 国外速度 | 稳定性 | 推荐度 |
|---------|---------|---------|--------|--------|
| 字节跳动 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | 首选 |
| 七牛云 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ | 推荐 |
| 又拍云 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | 推荐 |
| Cloudflare | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | 备用 |
| jsDelivr | ⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ | 备用 |

## 🔄 更新记录

### 2026-02-27
- ✅ 添加多 CDN 自动切换功能
- ✅ 优先使用国内稳定 CDN
- ✅ 添加加载超时机制
- ✅ 添加友好的错误提示
- ✅ 添加加载状态日志

## 💡 技术细节

### 加载流程

```
页面加载
    ↓
尝试 CDN 1 (10秒超时)
    ↓ 失败
尝试 CDN 2 (10秒超时)
    ↓ 失败
尝试 CDN 3 (10秒超时)
    ↓ 成功
加载完成，初始化应用
```

### 错误处理

- 网络超时：自动切换下一个 CDN
- 加载失败：自动切换下一个 CDN
- 所有失败：显示错误页面，提供刷新按钮

## 🎉 优势

1. **高可用性**：5 个 CDN 备选，大幅提升成功率
2. **自动切换**：无需手动干预，自动选择可用 CDN
3. **国内优化**：优先使用国内 CDN，提升加载速度
4. **友好提示**：加载失败时提供详细的解决方案
5. **调试方便**：控制台显示详细的加载日志

## 📞 技术支持

如果仍然遇到问题，请提供：
1. 浏览器类型和版本
2. 控制台错误日志
3. 网络环境（家庭/公司/学校）
4. 是否使用了代理或 VPN
